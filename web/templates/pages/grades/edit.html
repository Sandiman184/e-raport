{% extends "layouts/base.html" %}

{% block title_icon %}<i data-lucide="file-edit"></i>{% endblock %}
{% block title %}Input Nilai{% endblock %}

{% block content %}
<div class="bg-white rounded-xl shadow-sm border border-gray-100 flex flex-col h-full">
    <!-- Header Section -->
    <div
        class="p-6 border-b border-gray-100 flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
        <div>
            <div class="flex items-center gap-2 mb-1">
                <span
                    class="px-2 py-0.5 rounded text-xs font-bold bg-teal-100 text-teal-700 uppercase tracking-wide">Semester
                    {{ semester }}</span>
                <span class="text-gray-400 text-xs text-xs">â€¢</span>
                <span class="text-gray-500 text-xs">Tahun Ajaran 2024/2025</span>
            </div>
            <h2 class="text-xl font-bold text-gray-800 flex items-center gap-2">
                {{ subject.name }}
            </h2>
            <p class="text-sm text-gray-500">Mata Pelajaran Kode: <span
                    class="font-mono text-xs bg-gray-100 px-1 rounded">{{ subject.code }}</span></p>
        </div>

        <div class="flex items-center gap-3">
            <div class="flex bg-gray-100 p-1 rounded-lg">
                <a href="{{ url_for('grades.edit', subject_id=subject.id, semester=1) }}"
                    class="px-3 py-1.5 text-sm font-medium rounded-md transition {{ 'bg-white text-teal-700 shadow-sm' if semester==1 else 'text-gray-500 hover:text-gray-700' }}">Sem
                    1</a>
                <a href="{{ url_for('grades.edit', subject_id=subject.id, semester=2) }}"
                    class="px-3 py-1.5 text-sm font-medium rounded-md transition {{ 'bg-white text-teal-700 shadow-sm' if semester==2 else 'text-gray-500 hover:text-gray-700' }}">Sem
                    2</a>
            </div>

            <a href="{{ url_for('grades.index') }}"
                class="text-gray-500 hover:text-gray-700 p-2 rounded-lg hover:bg-gray-100 transition" title="Kembali">
                <i data-lucide="x" class="w-5 h-5"></i>
            </a>
        </div>
    </div>

    <!-- Alert / Info -->
    <div class="px-6 pt-4">
        <div class="bg-blue-50 text-blue-800 text-sm px-4 py-3 rounded-lg border border-blue-100 flex items-start">
            <i data-lucide="info" class="w-5 h-5 mr-2 flex-shrink-0"></i>
            <div>
                <strong>Petunjuk:</strong> Isi nilai 0-100. Kolom <strong>NR</strong> (Nilai Raport) akan dihitung
                otomatis saat disimpan.
                Gunakan tombol <strong>TAB</strong> di keyboard untuk pindah kolom dengan cepat.
            </div>
        </div>
    </div>

    <!-- Form Table -->
    <form method="post" action="" class="flex-1 flex flex-col p-6 pt-4">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

        <div class="overflow-auto border border-gray-200 rounded-lg shadow-sm max-h-[65vh]">
            <table class="min-w-full divide-y divide-gray-200 relative">
                <thead class="bg-gray-50 sticky top-0 z-10 shadow-sm">
                    <tr>
                        <th
                            class="px-4 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider w-12 border-b">
                            No</th>
                        <th
                            class="px-4 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider border-b">
                            Nama Santri</th>
                        <th
                            class="px-2 py-3 text-center text-xs font-bold text-gray-500 uppercase tracking-wider w-24 border-b bg-yellow-50/50">
                            NH</th>
                        <th
                            class="px-2 py-3 text-center text-xs font-bold text-gray-500 uppercase tracking-wider w-24 border-b bg-blue-50/50">
                            NK</th>
                        <th
                            class="px-2 py-3 text-center text-xs font-bold text-gray-500 uppercase tracking-wider w-24 border-b bg-purple-50/50">
                            NU</th>
                        <th
                            class="px-4 py-3 text-center text-xs font-bold text-gray-500 uppercase tracking-wider w-24 border-b bg-gray-100">
                            NR</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    {% for student in students %}
                    {% set g = existing_grades.get(student.id) %}
                    <tr class="hover:bg-teal-50/30 transition group">
                        <td class="px-4 py-2 text-center text-sm text-gray-500">{{ loop.index }}</td>
                        <td class="px-4 py-2 text-sm font-medium text-gray-900 group-hover:text-teal-700">{{
                            student.name }}</td>

                        <!-- Inputs -->
                        <td class="px-2 py-1 bg-yellow-50/20">
                            <input type="number" step="0.01" name="s_{{ student.id }}_nh"
                                value="{{ g.nh if g and g.nh else '' }}"
                                class="w-full text-center border-gray-300 rounded focus:ring-2 focus:ring-yellow-400 focus:border-yellow-400 text-sm py-1.5 transition"
                                placeholder="-">
                        </td>
                        <td class="px-2 py-1 bg-blue-50/20">
                            <input type="number" step="0.01" name="s_{{ student.id }}_nk"
                                value="{{ g.nk if g and g.nk else '' }}"
                                class="w-full text-center border-gray-300 rounded focus:ring-2 focus:ring-blue-400 focus:border-blue-400 text-sm py-1.5 transition"
                                placeholder="-">
                        </td>
                        <td class="px-2 py-1 bg-purple-50/20">
                            <input type="number" step="0.01" name="s_{{ student.id }}_nu"
                                value="{{ g.nu if g and g.nu else '' }}"
                                class="w-full text-center border-gray-300 rounded focus:ring-2 focus:ring-purple-400 focus:border-purple-400 text-sm py-1.5 transition"
                                placeholder="-">
                        </td>

                        <!-- NR Display (Read Only) -->
                        <td class="px-4 py-2 text-center text-sm font-bold text-gray-700 bg-gray-50">
                            {{ g.nr|round(0)|int if g and g.nr else '-' }}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div class="mt-6 flex justify-between items-center">
            <span class="text-sm text-gray-500 italic">* Nilai otomatis tersimpan ke database saat tombol
                ditekan.</span>
            <div class="flex gap-3">
                <a href="{{ url_for('grades.index') }}"
                    class="px-6 py-2.5 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 text-gray-700 font-medium transition">
                    Batal
                </a>
                <button type="submit"
                    class="px-8 py-2.5 bg-teal-600 hover:bg-teal-700 text-white rounded-lg font-bold shadow-md hover:shadow-lg transition flex items-center gap-2">
                    <i data-lucide="save" class="w-4 h-4"></i> Simpan Nilai
                </button>
            </div>
        </div>
    </form>
</div>
{% endblock %}